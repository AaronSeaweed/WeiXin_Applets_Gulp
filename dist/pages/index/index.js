"use strict";var app=getApp();Page({data:{motto:"老徐你好",userInfo:{},hasUserInfo:!1,canIUse:wx.canIUse("button.open-type.getUserInfo"),menuTapCurrent:1,menuList:[],foodList:[],scroll_height:0,carData:[],menuindex:1},onLoad:function(){var a=this;app.globalData.userInfo?this.setData({userInfo:app.globalData.userInfo,hasUserInfo:!0}):this.data.canIUse?app.userInfoReadyCallback=function(t){a.setData({userInfo:t.userInfo,hasUserInfo:!0})}:wx.getUserInfo({success:function(t){app.globalData.userInfo=t.userInfo,a.setData({userInfo:t.userInfo,hasUserInfo:!0})}});var t=wx.getSystemInfoSync().windowHeight,e=wx.getSystemInfoSync().windowWidth;this.setData({scroll_height:750*t/e-228-30}),wx.showLoading({title:"加载中"})},onShow:function(){this.getMenuList(),this.getFoodList(this.data.menuindex)},getUserInfo:function(t){app.globalData.userInfo=t.detail.userInfo,this.setData({userInfo:t.detail.userInfo,hasUserInfo:!0})},menuTap:function(t){var a=t.currentTarget.dataset.current;this.setData({menuTapCurrent:a}),this.setData({toView:"sw"+Number(a-2)}),this.getFoodList(a)},getMenuList:function(){var a=this;wx.request({url:app.globalData.httpHost+"/weixin/getfoodtype",method:"POST",data:{},success:function(t){200==t.data.status&&"success"==t.data.message?(a.setData({hasData:!0,menuList:t.data.data}),setTimeout(function(){wx.hideLoading()},500)):500==t.data.code&&a.setData({hasData:!1,menuList:[]})}})},getFoodList:function(a){var e=this;wx.request({url:app.globalData.httpHost+"/weixin/getfood",method:"POST",data:{foodtypeid:a},success:function(t){200==t.data.status&&"success"==t.data.message?e.setData({hasData:!0,foodList:t.data.data,menuindex:a}):500==t.data.code&&e.setData({hasData:!1,foodList:[]})}})},AddCar:function(s){var o=this,n=s.currentTarget.dataset.index;o.setData({carData:s.currentTarget.dataset.food}),wx.showToast({title:"成功加入购物车",icon:"succes",duration:1e3,mask:!0,success:function(){for(var t in o.data.carData)if(o.data.carData[t].foodid==s.currentTarget.dataset.food[n].foodid){o.data.carData[t].count=1;var a=wx.getStorageSync("cart")||[];if(0<a.length){for(var e in a)if(a[e].foodid==s.currentTarget.dataset.food[n].foodid){a[e].count=a[e].count+1;try{wx.setStorageSync("cart",a)}catch(t){console.log(t)}return}o.data.carData[t].checked=!0,a.push(o.data.carData[t])}else o.data.carData[t].checked=!0,a.push(o.data.carData[t]);try{return void wx.setStorageSync("cart",a)}catch(t){console.log(t)}}},fail:function(){}})}});