"use strict";Page({data:{carts:[],hasList:!1,totalPrice:0,goodsCount:0,goodsTypeCount:0,selectAllStatus:!0},onLoad:function(){wx.showLoading({title:"加载中"})},onShow:function(){var t=wx.getStorageSync("cart")||[];if(0<t.length){for(var a in this.data.goodsTypeCount=0,t)t[a].checked&&(this.data.goodsTypeCount++,this.data.totalPrice+=Number(t[a].price.toFixed(2))*t[a].count,this.data.goodsCount+=Number(t[a].count));this.setData({hasList:!0,carts:t,totalPrice:this.data.totalPrice.toFixed(2),goodsCount:this.data.goodsCount,selectAllStatus:this.data.goodsTypeCount==t.length}),wx.setStorageSync("cart",t)}else this.setData({hasList:!1})},onReady:function(){wx.hideLoading()},onHide:function(){var t=this;setTimeout(function(){t.setData({totalPrice:0,goodsCount:0})},500)},checkboxChange:function(t){var a=0;for(var e in this.data.carts[t.target.dataset.index].checked=!this.data.carts[t.target.dataset.index].checked,this.recalculate(this.data.carts),this.data.carts)this.data.carts[e].checked&&a++;this.setData({selectAllStatus:a==this.data.carts.length})},allcheckboxChange:function(t){for(var a=0;a<this.data.carts.length;a++)this.data.carts[a].checked=!this.data.selectAllStatus;this.recalculate(this.data.carts),this.setData({selectAllStatus:!this.data.selectAllStatus})},delcarfood:function(e){var s=this;wx.showModal({title:"提示",content:"您确定删除该商品吗？",success:function(t){if(t.confirm){var a=wx.getStorageSync("cart");!function(t,a){for(var e=t.length-1;0<=e;e--)if(e==a){t.splice(e,1);break}}(a,e.target.dataset.index),0<a.length?s.recalculate(a,1):(s.setData({hasList:!1,firstenter:!0}),wx.setStorageSync("cart",a))}else t.cancel}})},recalculate:function(t,a){for(var e=0,s=0,c=this.data.goodsTypeCount=0;c<t.length;c++)t[c].checked&&(this.data.goodsTypeCount++,e+=Number(t[c].price.toFixed(2))*t[c].count,s+=Number(t[c].count));this.setData({carts:t,totalPrice:e.toFixed(2),goodsCount:s}),a&&this.setData({selectAllStatus:this.data.goodsTypeCount==this.data.carts.length}),wx.setStorageSync("cart",t)},lesscount:function(t){if(1==this.data.carts[t.target.dataset.index].count)this.delcarfood(t);else{for(var a=0;a<this.data.carts.length;a++)a==t.target.dataset.index&&this.data.carts[a].count--;this.recalculate(this.data.carts)}},addcount:function(t){for(var a=0;a<this.data.carts.length;a++)a==t.target.dataset.index&&this.data.carts[a].count++;this.recalculate(this.data.carts)},checkOrder:function(){0<this.data.goodsCount?wx.navigateTo({url:"../checkOrder/checkOrder"}):wx.showToast({title:"请选择有效商品",icon:"none",duration:2e3})}});